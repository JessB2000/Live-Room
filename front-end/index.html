<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live-Room</title>
</head>

<body>
    <main>
        <div id="main">

            <input type="text" name="" id="inputName">
            <input type="text" name="" id="inputMovie">
            <input type="button" id="create" value="Criar Sala">
            <input type="text" name="" id="sala">
            <input type="button" value="entrar na sala" id="entrar">
        
        </div>

    </main>
</body>

    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
        integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H"
        crossorigin="anonymous"></script>
    <script>
        var socket = io.connect("http:///");
        var currentIdRoom = null

        socket.on("connect", function () {

        });

        socket.on("connection", function (sc) {
            currentIdRoom = sc
            console.log(sc)
        });

        socket.on("removeRoom", function (roomId) {
            console.log("removeu");
        });

        const roomName = document.getElementById("inputName")
        const texto = document.getElementById("inputMovie")
        const button = document.getElementById("create")
        button.addEventListener("click", async () => {
            console.log(texto.value);
            const res = await fetch(`http://localhost:3000/create?nameRoom=${roomName.value}&linkVideo=${texto.value}`)
            const result = await res.json();
            createNewRoom(texto.value, result.roomId); 
            console.log(result.roomId)
            currentIdRoom = result.roomId; 
        })
      
    function createNewRoom(linkVideo, id_Room){ 
        document.getElementById("main").remove();
        document.querySelector("main").innerHTML = `
        <main>
        <div id="main">
        <iframe id="video" width="560" height="315" src="https://www.youtube.com/embed/${linkVideo}"
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
      
       <div>
        <p> O link para a sala é: </p>
        <p id="link"> ${id_Room} </p> 
        </div>

        <div>
        <p> Para deletar sala, aperte: </p>
        <input type="button" name="" id="remove">
        </div>
        </div>
        </main>
        `
      const box = document.getElementById("remove");
      const roomVideo = document.getElementById("room");
      box.addEventListener("click", async () => {
           console.log("valor do id: ", currentIdRoom); 
            const res = await fetch(`http://localhost:3000/delete?roomId=${currentIdRoom}`)
            const result = await res.json();
            removeThisRoom(currentIdRoom); 
            console.log(result);
        })
    }
    function removeThisRoom(room){
        document.getElementById("main").remove();
        document.querySelector("main").innerHTML =`
        <p> Fim de chat</p>
        `
    }

    const boxEntrar = document.getElementById("entrar");
    const inputSala = document.getElementById("sala");
      boxEntrar.addEventListener("click", async () => {
            const res = await fetch(`http://localhost:3000/enter?roomId=${inputSala.value}`)
            if(res.status == 200){
            const result = await res.json();
            createNewRoom(result.video, result.idRoom);
            currentIdRoom = inputSala.value;
            }
            else {
                alert('sala não encontrada'); 
            }
            console.log(result);
        })
    </script>


</html>