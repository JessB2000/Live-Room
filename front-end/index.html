<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live-Room</title>
</head>

<body>
    <main>
        <div id="main">

            <input type="text" name="" id="inputName">
            <input type="text" name="" id="inputMovie">
            <input type="button" id="create" value="Criar Sala">
        
        </div>

    </main>
</body>

    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
        integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H"
        crossorigin="anonymous"></script>
    <script>
        var socket = io.connect("http:///");
        var currentIdSocket = null

        socket.on("connect", function () {

        });

        socket.on("connection", function (sc) {
            currentIdSocket = sc
            console.log(sc)
        });

       /* socket.on("update", function (data) { // não deu tempo de ser implementada
            console.log(data);
        });*/

       /* socket.on("newUser", function (data) {
            addUser(user);
        });*/
        
       /* socket.on("exitUser", function (data) {
            removeUser(user);
        });*/ 

        socket.on("removeRoom", function (data) {
            console.log("removeu");
        });

        const roomName = document.getElementById("inputName")
        const texto = document.getElementById("inputMovie")
        const button = document.getElementById("create")
        button.addEventListener("click", async () => {
            console.log(roomName.value); 
            const res = await fetch(`http://localhost:3000/create?nameRoom=${roomName.value}&roomId=${texto.value}`)
            const result = await res.json();
            createNewRoom(); 
            console.log(result);
        })

       /* const textoSala = document.getElementById("inputRoom")
        const buttonSala = document.getElementById("enter")
        buttonSala.addEventListener("click", async () => {
            const res = await fetch(`http://localhost:3000/enter?userId=${currentIdSocket}&roomId=${textoSala.value}`)
            const result = await res.json();
            addUser(currentIdSocket);
            createNewRoom(textoSala.value);  
            console.log(result);
        })*/
      
    function createNewRoom(){
        document.getElementById("main").remove();
        document.querySelector("main").innerHTML = `
        <main>
        <div id="main">
        <iframe id="video" width="560" height="315" src=${setMovie}
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
      
       <div>
        <p> O link para a sala é: </p>
        <input type="text" name="" id="link">
        </div>

        <div>
        <p> Para deletar sala, aperte: </p>
        <input type="button" name="" id="remove">
        </div>
        </div>
        </main>
        `
      const box = document.getElementById("remove");
      const roomVideo = document.getElementById("room"); 
      box.addEventListener("click", async () => {
            console.log(roomName.value); 
            const res = await fetch(`http://localhost:3000/delete?roomId=${texto.value}`)
            const result = await res.json();
            removeThisRoom(texto.value); 
            console.log(result);
        })
    }
    function removeThisRoom(room){
        document.getElementById("main").remove();
        document.querySelector("main").innerHTML =`
        <p> fim de chat</p>
        `
    }
    const room = {
    roomId: "12012",
    userMaster: "1720",
    movieId: "2520",
    timeMovie: "2000",
    usersInvited: [
        {
            id: "1724",
        },
    ],
};

const newRoom = {
    roomId: "120120",
    userMaster: "17200",
    movieId: "https://www.youtube.com/embed/qQeGOVQIZQQ",
    timeMovie: "20000",
    usersInvited: [
        {
            id: "17240",
        },
    ],
};

const setMovie = (link) => {
    document.getElementById("inputMovie").setAttribute("src", link);
};

const setTimeMovie = () => { };

/*const addUser = (user) => {
    const li = document.createElement("li");
    li.innerHTML = `Usuário: ${user}`
    li.setAttribute("id", user);
    document.getElementById("users").appendChild(li);
};

const removeUser = (user) => {
   document.getElementById(user).remove(); 
 };

const updateRoom = (room, newRoom) => {
    newRoom.movieId != room.movieId && setMovie(newRoom.movieId);

    newRoom.timeMovie != room.timeMovie && setTimeMovie(newRoom.timeMovie);

    room.usersInvited.forEach((user) => {
        if (newRoom.usersInvited.find((us) => us.id == user.id) == null) {
            removeUser(user.id);
        }
    });

    newRoom.usersInvited.forEach((user) => {
        if (room.usersInvited.find((us) => us.id == user.id) == null) {
            addUser(user.id);
        }
    });
};

updateRoom(room, newRoom); */
    </script>


</html>